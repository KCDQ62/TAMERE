// Ajoutez ce fichier : js/demo-mode.js
// Mode dÃ©mo sans backend pour GitHub Pages

class DemoMode {
  constructor() {
    this.demoUser = {
      id: 'demo-user-1',
      username: 'Utilisateur Demo',
      email: 'demo@example.com',
      avatar: ''
    };
    
    this.demoMessages = [
      {
        _id: '1',
        sender: { _id: 'demo-user-2', username: 'Alice' },
        content: 'Salut ! Bienvenue dans la dÃ©mo ðŸ‘‹',
        createdAt: new Date(Date.now() - 3600000)
      },
      {
        _id: '2',
        sender: { _id: 'demo-user-1', username: 'Utilisateur Demo' },
        content: 'Merci ! C\'est super comme application !',
        createdAt: new Date(Date.now() - 3000000)
      },
      {
        _id: '3',
        sender: { _id: 'demo-user-2', username: 'Alice' },
        content: 'N\'hÃ©site pas Ã  tester toutes les fonctionnalitÃ©s ðŸ˜Š',
        createdAt: new Date(Date.now() - 1800000)
      }
    ];

    this.demoConversations = [
      {
        id: 'demo-user-2',
        name: 'Alice',
        type: 'user',
        lastMessage: 'N\'hÃ©site pas Ã  tester...',
        lastMessageTime: new Date(Date.now() - 1800000),
        status: 'online',
        unreadCount: 0
      },
      {
        id: 'demo-user-3',
        name: 'Bob',
        type: 'user',
        lastMessage: 'Ã€ plus tard !',
        lastMessageTime: new Date(Date.now() - 7200000),
        status: 'offline',
        unreadCount: 2
      }
    ];

    this.demoGroups = [
      {
        _id: 'demo-group-1',
        name: 'Ã‰quipe Projet',
        members: [
          { user: { username: 'Alice' } },
          { user: { username: 'Bob' } },
          { user: { username: 'Charlie' } }
        ]
      }
    ];
  }

  // Simuler l'authentification
  async login(email, password) {
    await this.delay(1000); // Simuler le dÃ©lai rÃ©seau
    
    localStorage.setItem('token', 'demo-token-123');
    localStorage.setItem('user', JSON.stringify(this.demoUser));
    
    return { success: true, user: this.demoUser };
  }

  async register(username, email, password) {
    await this.delay(1000);
    
    const user = { ...this.demoUser, username, email };
    localStorage.setItem('token', 'demo-token-123');
    localStorage.setItem('user', JSON.stringify(user));
    
    return { success: true, user };
  }

  // Simuler les conversations
  async getConversations() {
    await this.delay(500);
    return this.demoConversations;
  }

  // Simuler les messages
  async getMessages(conversationId) {
    await this.delay(500);
    return this.demoMessages;
  }

  // Simuler l'envoi de message
  async sendMessage(content) {
    await this.delay(300);
    
    const message = {
      _id: Date.now().toString(),
      sender: this.demoUser,
      content,
      createdAt: new Date()
    };
    
    this.demoMessages.push(message);
    
    // Simuler une rÃ©ponse aprÃ¨s 2 secondes
    setTimeout(() => {
      const reply = {
        _id: (Date.now() + 1).toString(),
        sender: { _id: 'demo-user-2', username: 'Alice' },
        content: 'Message reÃ§u ! (Mode dÃ©mo)',
        createdAt: new Date()
      };
      this.demoMessages.push(reply);
      UI.addMessageToUI(reply);
      UI.scrollToBottom();
    }, 2000);
    
    return message;
  }

  // Simuler les groupes
  async getGroups() {
    await this.delay(500);
    return this.demoGroups;
  }

  // Fonction utilitaire pour simuler le dÃ©lai
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // Afficher le badge DEMO
  showDemoBanner() {
    const banner = document.createElement('div');
    banner.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px;
      text-align: center;
      font-weight: 600;
      z-index: 10000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    `;
    banner.innerHTML = `
      ðŸŽ­ MODE DÃ‰MO - Les donnÃ©es ne sont pas sauvegardÃ©es
      <a href="https://github.com/votre-repo" target="_blank" 
         style="color: white; margin-left: 20px; text-decoration: underline;">
        Voir le code source
      </a>
    `;
    document.body.appendChild(banner);
    
    // Ajuster le padding du contenu
    document.body.style.paddingTop = '48px';
  }
}

// Instance globale
const demo = new DemoMode();

// DÃ©tecter si on est sur GitHub Pages
const isGitHubPages = window.location.hostname.includes('github.io');

if (isGitHubPages) {
  console.log('ðŸŽ­ Mode dÃ©mo activÃ© - GitHub Pages dÃ©tectÃ©');
  demo.showDemoBanner();
  
  // Remplacer les fonctions Auth
  Auth.login = (email, password) => demo.login(email, password);
  Auth.register = (username, email, password) => demo.register(username, email, password);
  
  // EmpÃªcher les vraies requÃªtes API
  window.fetch = async (url, options) => {
    console.log('ðŸŽ­ RequÃªte interceptÃ©e en mode dÃ©mo:', url);
    
    if (url.includes('/conversations')) {
      return { ok: true, json: async () => demo.demoConversations };
    }
    if (url.includes('/messages')) {
      return { ok: true, json: async () => demo.demoMessages };
    }
    if (url.includes('/groups')) {
      return { ok: true, json: async () => demo.demoGroups };
    }
    
    return { ok: true, json: async () => ({}) };
  };
  
  // Simuler Socket.IO
  socket.connect = () => {
    setTimeout(() => socket.trigger('connected'), 500);
  };
  
  socket.sendPrivateMessage = (recipientId, content) => {
    demo.sendMessage(content).then(msg => {
      UI.addMessageToUI(msg);
      UI.scrollToBottom();
    });
  };
}