# Configuration du serveur TURN pour WebRTC
# Ce fichier configure coturn pour la signalisation WebRTC

# Adresse d'écoute principale
listening-ip=0.0.0.0

# Port d'écoute pour TURN
listening-port=3478

# Port d'écoute pour TURN over TLS
tls-listening-port=5349

# Plage de ports pour les relais média
min-port=49152
max-port=65535

# Utiliser l'empreinte digitale dans les messages TURN
fingerprint

# Activer le support des connexions longues
lt-cred-mech

# Nom de domaine/realm pour l'authentification
realm=votre-domaine.com

# Activer les logs détaillés (désactiver en production)
verbose

# Fichier de log
log-file=/var/log/turnserver.log

# Utiliser syslog
syslog

# Refuser les connexions aux adresses privées (sécurité)
no-loopback-peers
no-multicast-peers

# Autoriser les connexions TCP et UDP
listening-port=3478
tls-listening-port=5349

# Base de données utilisateurs (format : username:password)
# Ou utiliser une base de données externe
user=username1:password1
user=username2:password2

# Ou utiliser une base de données Redis pour les utilisateurs
# redis-userdb="ip=127.0.0.1 dbname=2 password=turn connect_timeout=30"

# Certificats SSL/TLS pour TURNS (TURN over TLS)
# Nécessaire pour les connexions sécurisées
cert=/etc/ssl/certs/turn_server_cert.pem
pkey=/etc/ssl/private/turn_server_pkey.pem

# Certificat CA (optionnel)
# CA-file=/etc/ssl/certs/ca-bundle.crt

# Désactiver les connexions UDP/DTLS (optionnel)
# no-udp
# no-dtls

# Activer uniquement les connexions TCP/TLS (optionnel)
# no-udp
# no-dtls
# no-tcp
# no-tls

# Limiter la bande passante par utilisateur (en kbits/sec)
max-bps=1000000

# Limiter le nombre total de connexions
total-quota=100

# Limiter le nombre de connexions par utilisateur
user-quota=10

# Désactiver la résolution DNS (utiliser uniquement les IPs)
# no-stun-backward-compatibility

# Autoriser les connexions depuis n'importe quelle adresse IP
# denied-peer-ip=0.0.0.0-255.255.255.255

# Autoriser les connexions uniquement depuis certaines IPs
# allowed-peer-ip=192.168.1.0-192.168.1.255

# Définir l'IP publique du serveur (importante pour NAT)
# external-ip=VOTRE_IP_PUBLIQUE

# Exemple avec IP statique :
# external-ip=203.0.113.1

# Exemple avec détection automatique :
# external-ip=auto-detect

# Activer le mode CLI (Command Line Interface)
cli-password=votreMotDePasseAdmin
cli-port=5766

# Désactiver les connexions CLI depuis l'extérieur
# cli-ip=127.0.0.1

# Statistiques et monitoring
# Activer le serveur web de statistiques
web-admin
web-admin-ip=127.0.0.1
web-admin-port=8080

# Mot de passe pour l'interface web
# web-admin-password=votreMotDePasseWeb

# Base de données SQLite pour les statistiques (optionnel)
# userdb=/var/db/turndb

# Options de performance
# Nombre de threads de traitement
# proc-user=turnserver
# proc-group=turnserver

# Limiter l'utilisation CPU
# cpu-limit=100

# Optimisations réseau
# no-tcp-relay
# no-udp-relay

# Options de sécurité supplémentaires
# Bloquer les requêtes sans authentification
stale-nonce=600

# Rotation des clés
# mobility

# Support pour les anciens clients WebRTC
# stun-only

# Désactiver les connexions non chiffrées en production
# secure-stun

# Forcer l'utilisation de TLS/DTLS
# no-tlsv1
# no-tlsv1_1

# Configuration pour Docker (si utilisé)
# listening-ip=0.0.0.0
# relay-ip=0.0.0.0
# external-ip=auto-detect

# ============================================
# CONFIGURATION RECOMMANDÉE POUR PRODUCTION
# ============================================

# 1. Décommenter et configurer external-ip avec votre IP publique
# external-ip=VOTRE_IP_PUBLIQUE

# 2. Utiliser des certificats SSL valides pour TURNS
# cert=/etc/letsencrypt/live/votre-domaine.com/fullchain.pem
# pkey=/etc/letsencrypt/live/votre-domaine.com/privkey.pem

# 3. Configurer l'authentification via base de données
# redis-userdb ou userdb SQLite recommandé pour production

# 4. Désactiver verbose en production
# Commenter la ligne "verbose" ci-dessus

# 5. Configurer les limites selon votre infrastructure
# max-bps, total-quota, user-quota

# ============================================
# NOTES D'INSTALLATION
# ============================================

# Installation sur Ubuntu/Debian :
# sudo apt-get install coturn
# sudo systemctl enable coturn
# sudo systemctl start coturn

# Installation sur CentOS/RHEL :
# sudo yum install coturn
# sudo systemctl enable coturn
# sudo systemctl start coturn

# Tester le serveur TURN :
# turnutils_uclient -v -u username1 -w password1 VOTRE_IP_PUBLIQUE

# Ouvrir les ports dans le firewall :
# sudo ufw allow 3478/tcp
# sudo ufw allow 3478/udp
# sudo ufw allow 5349/tcp
# sudo ufw allow 5349/udp
# sudo ufw allow 49152:65535/tcp
# sudo ufw allow 49152:65535/udp